module.exports=[63021,(a,b,c)=>{b.exports=a.x("@prisma/client-2c3a283f134fdcb6",()=>require("@prisma/client-2c3a283f134fdcb6"))},66518,a=>{"use strict";var b=a.i(63021);let c=a.g.prisma||new b.PrismaClient({});a.s(["prisma",0,c])},24868,(a,b,c)=>{b.exports=a.x("fs/promises",()=>require("fs/promises"))},49841,a=>{"use strict";var b=a.i(37936),c=a.i(66518),d=a.i(9307),e=a.i(18558),f=a.i(13095);async function g(a,b){let f=await (0,d.getSession)();if(!f)return{error:"Unauthorized"};let g=await c.prisma.event.findUnique({where:{id:a}});if(!g)return{error:"Event not found"};if(g.userId!==f.userId&&"ADMIN"!==f.role)return{error:"Forbidden"};try{if(await c.prisma.event.update({where:{id:a},data:{title:b.title,date:b.date?new Date(b.date):void 0,location:b.location,logoUrl:b.logoUrl,logoSize:b.logoSize?parseInt(b.logoSize.toString()):150,musicUrl:b.musicUrl,groomFatherName:b.groomFatherName,groomMotherName:b.groomMotherName,brideFatherName:b.brideFatherName,brideMotherName:b.brideMotherName,groomFirstName:b.groomFirstName,groomLastName:b.groomLastName,brideFirstName:b.brideFirstName,brideLastName:b.brideLastName,invitationMessage:b.invitationMessage,eventTime:b.eventTime,venueDetails:b.venueDetails,mapUrl:b.mapUrl,schedule:b.schedule,template:b.templateId?{connect:{codeKey:b.templateId}}:void 0,slug:b.slug||void 0}}),!g.slug&&(b.groomLastName||b.brideLastName)){let d=b.groomLastName||g.groomLastName||"groom",e=b.brideLastName||g.brideLastName||"bride",f=`${d}-${e}`.toLowerCase().replace(/[^a-z0-9]/g,""),h=Math.random().toString(36).substring(2,7),i=`${f}-${h}`;await c.prisma.event.update({where:{id:a},data:{slug:i}})}return(0,e.revalidatePath)(`/dashboard/events/${a}`),(0,e.revalidatePath)("/dashboard"),{success:!0}}catch(a){return console.error("Update Event Error:",a),{error:`Failed to update event: ${a.message}`}}}(0,f.ensureServerEntryExports)([g]),(0,b.registerServerReference)(g,"60ec40f64769b398f20bbc6185250693945c16b9f2",null);var h=a.i(24868),i=a.i(14747);async function j(a){if(!await (0,d.getSession)())return{error:"Unauthorized"};let b=a.get("file"),c=a.get("folder")||"misc";if(!b)return{error:"No file provided"};try{let a=await b.arrayBuffer(),d=Buffer.from(a),e=`${Date.now()}-${b.name.replace(/\s/g,"_")}`,f=i.default.join(process.cwd(),"public/uploads",c);try{await (0,h.mkdir)(f,{recursive:!0})}catch(a){}let g=i.default.join(f,e);await (0,h.writeFile)(g,d);let j=`/uploads/${c}/${e}`;return{success:!0,url:j}}catch(a){return console.error("Upload Error:",a),{error:"Failed to upload file"}}}async function k(a,b,f=0){let g=await (0,d.getSession)();if(!g)return{error:"Unauthorized"};let h=await c.prisma.event.findUnique({where:{id:a}});if(!h)return{error:"Event not found"};if(h.userId!==g.userId&&"ADMIN"!==g.role)return{error:"Forbidden"};try{let d=await c.prisma.albumPhoto.create({data:{eventId:a,imageUrl:b,order:f}});return(0,e.revalidatePath)(`/dashboard/events/${a}`),(0,e.revalidatePath)(`/invitation/${a}`),{success:!0,photo:d}}catch(a){return console.error("Add Album Photo Error:",a),{error:"Failed to add photo"}}}async function l(a){let b=await (0,d.getSession)();if(!b)return{error:"Unauthorized"};try{let d=await c.prisma.albumPhoto.findUnique({where:{id:a},include:{event:!0}});if(!d)return{error:"Photo not found"};if(d.event.userId!==b.userId&&"ADMIN"!==b.role)return{error:"Forbidden"};return await c.prisma.albumPhoto.delete({where:{id:a}}),(0,e.revalidatePath)(`/dashboard/events/${d.eventId}`),(0,e.revalidatePath)(`/invitation/${d.eventId}`),{success:!0}}catch(a){return console.error("Delete Album Photo Error:",a),{error:"Failed to delete photo"}}}async function m(a,b){let f=await (0,d.getSession)();if(!f)return{error:"Unauthorized"};let g=await c.prisma.event.findUnique({where:{id:a}});if(!g)return{error:"Event not found"};if(g.userId!==f.userId&&"ADMIN"!==f.role)return{error:"Forbidden"};try{return await c.prisma.$transaction(b.map(({id:a,order:b})=>c.prisma.albumPhoto.update({where:{id:a},data:{order:b}}))),(0,e.revalidatePath)(`/dashboard/events/${a}`),(0,e.revalidatePath)(`/invitation/${a}`),{success:!0}}catch(a){return console.error("Reorder Album Photos Error:",a),{error:"Failed to reorder photos"}}}async function n(a,b,f){if(!await (0,d.getSession)())return{error:"Unauthorized"};try{let d="",g=!1;for(;!g;)d=Math.random().toString(36).substring(2,7).toUpperCase(),await c.prisma.guest.findUnique({where:{shortCode:d}})||(g=!0);let h=await c.prisma.guest.create({data:{eventId:a,name:b,phoneNumber:f||null,shortCode:d}});return(0,e.revalidatePath)(`/dashboard/events/${a}`),{success:!0,guest:h}}catch(a){return console.error("Add Guest Error:",a),{error:"Failed to add guest"}}}async function o(a,b,f){if(!await (0,d.getSession)())return{error:"Unauthorized"};try{let d=await c.prisma.guest.update({where:{id:a},data:f});return(0,e.revalidatePath)(`/dashboard/events/${b}`),{success:!0,guest:d}}catch(a){return console.error("Update Guest Error:",a),{error:"Failed to update guest"}}}async function p(a,b){if(!await (0,d.getSession)())return{error:"Unauthorized"};try{return await c.prisma.guest.delete({where:{id:a}}),(0,e.revalidatePath)(`/dashboard/events/${b}`),{success:!0}}catch(a){return{error:"Failed"}}}(0,f.ensureServerEntryExports)([j]),(0,b.registerServerReference)(j,"4069b0e6d9b5a66c1783cd700553e02c483a28757d",null),(0,f.ensureServerEntryExports)([k,l,m]),(0,b.registerServerReference)(k,"701d40b024e579a0d8d5ad87c41f1fa30842509f46",null),(0,b.registerServerReference)(l,"40e2dd1298b25f0a906c769f457eb1e011ac1ad87b",null),(0,b.registerServerReference)(m,"605ff67c6846c5be0f5a5536bc2a2ff05b42cf9520",null),(0,f.ensureServerEntryExports)([n,o,p]),(0,b.registerServerReference)(n,"706ccd924b9d5851528cce1a82fe886473acd60439",null),(0,b.registerServerReference)(o,"7055d39d62a456560a66e0d6dd2ef90fe598beb107",null),(0,b.registerServerReference)(p,"600305cacccb6dadec5ba04c3c23834c91a7b3a339",null),a.s([],521),a.i(521),a.s(["4069b0e6d9b5a66c1783cd700553e02c483a28757d",()=>j,"40e2dd1298b25f0a906c769f457eb1e011ac1ad87b",()=>l,"600305cacccb6dadec5ba04c3c23834c91a7b3a339",()=>p,"60ec40f64769b398f20bbc6185250693945c16b9f2",()=>g,"701d40b024e579a0d8d5ad87c41f1fa30842509f46",()=>k,"706ccd924b9d5851528cce1a82fe886473acd60439",()=>n],49841)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__d9a462b5._.js.map